<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://no-sky.github.io/images/favicon.ico><meta name=robots content="noodp"><meta name=author content="nosky"><meta name=description content="nosky 的个人学习笔记"><meta name=keywords content="[note 笔记 nosky]"><link rel=prev href=https://no-sky.github.io/2018/mybatis%E4%B9%8B%E4%BC%98%E5%8C%96xml%E9%85%8D%E7%BD%AE/><link rel=next href=https://no-sky.github.io/2018/mybatis-generator%E4%B9%8Bmybatis%E7%9A%84%E5%BF%AB%E9%80%9F%E4%BD%BF%E7%94%A8/><link rel=canonical href=https://no-sky.github.io/2018/mybatis%E4%B9%8B%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2/><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><title>Mybatis之多表查询 | Note</title><meta name=title content="Mybatis之多表查询 | Note"><link rel=stylesheet href=/font/iconfont.css><link rel=stylesheet href=/css/main.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/no-sky.github.io"},"articleSection":"posts","name":"Mybatis之多表查询","headline":"Mybatis之多表查询","description":"\x3c!-- raw HTML omitted --\x3e\n\x3cp\x3e** 一对一 **\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e创建表和数据：\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cdiv class=\x22highlight\x22\x3e\x3cpre style=\x22color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\x22\x3e\x3ccode class=\x22language-sql\x22 data-lang=\x22sql\x22\x3e\t\x3cspan style=\x22color:#66d9ef\x22\x3eCREATE\x3c\/span\x3e \x3cspan style=\x22color:#66d9ef\x22\x3eTABLE\x3c\/span\x3e teacher(\n\t\tt_id INT \x3cspan style=\x22color:#66d9ef\x22\x3ePRIMARY\x3c\/span\x3e \x3cspan style=\x22color:#66d9ef\x22\x3eKEY\x3c\/span\x3e AUTO_INCREMENT, \n\t\tt_name VARCHAR(\x3cspan style=\x22color:#ae81ff\x22\x3e20\x3c\/span\x3e)\n\t);\n\t\x3cspan style=\x22color:#66d9ef\x22\x3eCREATE\x3c\/span\x3e \x3cspan style=\x22color:#66d9ef\x22\x3eTABLE\x3c\/span\x3e \x3cspan style=\x22color:#66d9ef\x22\x3eclass\x3c\/span\x3e(\n\t\tc_id INT \x3cspan style=\x22color:#66d9ef\x22\x3ePRIMARY\x3c\/span\x3e \x3cspan style=\x22color:#66d9ef\x22\x3eKEY\x3c\/span\x3e AUTO_INCREMENT, \n\t\tc_name VARCHAR(\x3cspan style=\x22color:#ae81ff\x22\x3e20\x3c\/span\x3e), \n\t\tteacher_id INT\n\t);\n\n\t\x3cspan style=\x22color:#66d9ef\x22\x3eALTER\x3c\/span\x3e \x3cspan style=\x22color:#66d9ef\x22\x3eTABLE\x3c\/span\x3e \x3cspan style=\x22color:#66d9ef\x22\x3eclass\x3c\/span\x3e \x3cspan style=\x22color:#66d9ef\x22\x3eADD\x3c\/span\x3e \x3cspan style=\x22color:#66d9ef\x22\x3eCONSTRAINT\x3c\/span\x3e fk_teacher_id \x3cspan style=\x22color:#66d9ef\x22\x3eFOREIGN\x3c\/span\x3e \x3cspan style=\x22color:#66d9ef\x22\x3eKEY\x3c\/span\x3e (teacher_id) \x3cspan style=\x22color:#66d9ef\x22\x3eREFERENCES\x3c\/span\x3e teacher(t_id);    \n\t\x3cspan style=\x22color:#66d9ef\x22\x3eINSERT\x3c\/span\x3e \x3cspan style=\x22color:#66d9ef\x22\x3eINTO\x3c\/span\x3e teacher(t_name) \x3cspan style=\x22color:#66d9ef\x22\x3eVALUES\x3c\/span\x3e(\x3cspan style=\x22color:#e6db74\x22\x3e\x26#39;\x3c\/span\x3e\x3cspan style=\x22color:#e6db74\x22\x3eLS1\x3c\/span\x3e\x3cspan style=\x22color:#e6db74\x22\x3e\x26#39;\x3c\/span\x3e);\n\t\x3cspan style=\x22color:#66d9ef\x22\x3eINSERT\x3c\/span\x3e \x3cspan style=\x22color:#66d9ef\x22\x3eINTO\x3c\/span\x3e teacher(t_name) \x3cspan style=\x22color:#66d9ef\x22\x3eVALUES\x3c\/span\x3e(\x3cspan style=\x22color:#e6db74\x22\x3e\x26#39;\x3c\/span\x3e\x3cspan style=\x22color:#e6db74\x22\x3eLS2\x3c\/span\x3e\x3cspan style=\x22color:#e6db74\x22\x3e\x26#39;\x3c\/span\x3e);\n\t\x3cspan style=\x22color:#66d9ef\x22\x3eINSERT\x3c\/span\x3e \x3cspan style=\x22color:#66d9ef\x22\x3eINTO\x3c\/span\x3e \x3cspan style=\x22color:#66d9ef\x22\x3eclass\x3c\/span\x3e(c_name, teacher_id) \x3cspan style=\x22color:#66d9ef\x22\x3eVALUES\x3c\/span\x3e(\x3cspan style=\x22color:#e6db74\x22\x3e\x26#39;\x3c\/span\x3e\x3cspan style=\x22color:#e6db74\x22\x3ebj_a\x3c\/span\x3e\x3cspan style=\x22color:#e6db74\x22\x3e\x26#39;\x3c\/span\x3e, \x3cspan style=\x22color:#ae81ff\x22\x3e1\x3c\/span\x3e);\n\t\x3cspan style=\x22color:#66d9ef\x22\x3eINSERT\x3c\/span\x3e \x3cspan style=\x22color:#66d9ef\x22\x3eINTO\x3c\/span\x3e \x3cspan style=\x22color:#66d9ef\x22\x3eclass\x3c\/span\x3e(c_name, teacher_id) \x3cspan style=\x22color:#66d9ef\x22\x3eVALUES\x3c\/span\x3e(\x3cspan style=\x22color:#e6db74\x22\x3e\x26#39;\x3c\/span\x3e\x3cspan style=\x22color:#e6db74\x22\x3ebj_b\x3c\/span\x3e\x3cspan style=\x22color:#e6db74\x22\x3e\x26#39;\x3c\/span\x3e, \x3cspan style=\x22color:#ae81ff\x22\x3e2\x3c\/span\x3e);\n\x3c\/code\x3e\x3c\/pre\x3e\x3c\/div\x3e","inLanguage":"en-us","author":"nosky","creator":"nosky","publisher":"nosky","accountablePerson":"nosky","copyrightHolder":"nosky","copyrightYear":"2018","datePublished":"2018-02-03 21:11:27 \x2b0000 UTC","dateModified":"2018-02-03 21:11:27 \x2b0000 UTC","url":"https:\/\/no-sky.github.io\/2018\/mybatis%E4%B9%8B%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2\/","wordCount":"433","keywords":["mybatis","Note"]}</script><script type=text/javascript async src="https://cdn.bootcss.com/mathjax/2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">MathJax.Hub.Config({tex2jax:{inlineMath:[['$','$'],['\\(','\\)']],displayMath:[['$$','$$'],['\[','\]']],processEscapes:true,processEnvironments:true,skipTags:['script','noscript','style','textarea','pre'],TeX:{equationNumbers:{autoNumber:"AMS"},extensions:["AMSmath.js","AMSsymbols.js"]}},"HTML-CSS":{linebreaks:{automatic:true}},SVG:{linebreaks:{automatic:true}}});MathJax.Hub.Queue(function(){var all=MathJax.Hub.getAllJax(),i;for(i=0;i<all.length;i+=1){all[i].SourceElement().parentNode.className+=' has-jax';}});</script><style>code.has-jax{font:inherit;font-size:100%;background:inherit;border:inherit;color:#515151}</style></head><body><div class=wrapper><nav class=navbar><div class=container><div class="navbar-header header-logo"><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href=https://no-sky.github.io>Note</a></div><div class="menu navbar-right"><a class=menu-item href=/posts/>Blog</a>
<a class=menu-item href=/tags/>Tags</a>
<a class=menu-item href=/about/>About</a></div></div></nav><nav class=navbar-mobile id=nav-mobile style=display:none><div class=container><div class=navbar-header><div><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href=https://no-sky.github.io>Note</a></div><div class=menu-toggle><span></span><span></span><span></span></div></div><div class=menu id=mobile-menu><a class=menu-item href=/posts/>Blog</a>
<a class=menu-item href=/tags/>Tags</a>
<a class=menu-item href=/about/>About</a></div></div></nav><main class=main><div class=container><article class=post-warp itemscope itemtype=http://schema.org/Article><header class=post-header><h1 class=post-title itemprop="name headline">Mybatis之多表查询</h1><div class=post-meta>Written by <a itemprop=name href=https://no-sky.github.io rel=author>nosky</a> with ♥
<span class=post-time>on <time datetime=2018-02-03 itemprop=datePublished>February 3, 2018</time></span>
in</div></header><div class=post-content><p>** 一对一 **</p><ol><li>创建表和数据：</li></ol><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql>	<span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> teacher(
		t_id INT <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span> AUTO_INCREMENT, 
		t_name VARCHAR(<span style=color:#ae81ff>20</span>)
	);
	<span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#66d9ef>class</span>(
		c_id INT <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span> AUTO_INCREMENT, 
		c_name VARCHAR(<span style=color:#ae81ff>20</span>), 
		teacher_id INT
	);

	<span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#66d9ef>class</span> <span style=color:#66d9ef>ADD</span> <span style=color:#66d9ef>CONSTRAINT</span> fk_teacher_id <span style=color:#66d9ef>FOREIGN</span> <span style=color:#66d9ef>KEY</span> (teacher_id) <span style=color:#66d9ef>REFERENCES</span> teacher(t_id);    
	<span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> teacher(t_name) <span style=color:#66d9ef>VALUES</span>(<span style=color:#e6db74>&#39;</span><span style=color:#e6db74>LS1</span><span style=color:#e6db74>&#39;</span>);
	<span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> teacher(t_name) <span style=color:#66d9ef>VALUES</span>(<span style=color:#e6db74>&#39;</span><span style=color:#e6db74>LS2</span><span style=color:#e6db74>&#39;</span>);
	<span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> <span style=color:#66d9ef>class</span>(c_name, teacher_id) <span style=color:#66d9ef>VALUES</span>(<span style=color:#e6db74>&#39;</span><span style=color:#e6db74>bj_a</span><span style=color:#e6db74>&#39;</span>, <span style=color:#ae81ff>1</span>);
	<span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> <span style=color:#66d9ef>class</span>(c_name, teacher_id) <span style=color:#66d9ef>VALUES</span>(<span style=color:#e6db74>&#39;</span><span style=color:#e6db74>bj_b</span><span style=color:#e6db74>&#39;</span>, <span style=color:#ae81ff>2</span>);
</code></pre></div><ol start=2><li>定义实体类：</li></ol><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Teacher</span> <span style=color:#f92672>{</span>
	    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> id<span style=color:#f92672>;</span>
	    <span style=color:#66d9ef>private</span> String name<span style=color:#f92672>;</span>
	<span style=color:#f92672>}</span>
	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Classes</span> <span style=color:#f92672>{</span>
	    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> id<span style=color:#f92672>;</span>
	    <span style=color:#66d9ef>private</span> String name<span style=color:#f92672>;</span>
	    <span style=color:#66d9ef>private</span> Teacher teacher<span style=color:#f92672>;</span>
	<span style=color:#f92672>}</span>
</code></pre></div><p>c. 定义sql映射文件ClassMapper.xml：</p><p>方式一：嵌套查询方式, 通过执行另外一个SQL映射语句来返回预期的复杂类型</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml>	<span style=color:#f92672>&lt;select</span> <span style=color:#a6e22e>id=</span><span style=color:#e6db74>&#34;getClasses&#34;</span> <span style=color:#a6e22e>parameterType=</span><span style=color:#e6db74>&#34;int&#34;</span> <span style=color:#a6e22e>resultMap=</span><span style=color:#e6db74>&#34;ClassesResultMap2&#34;</span><span style=color:#f92672>&gt;</span>
	    select * from class where c_id=#{id}
	<span style=color:#f92672>&lt;/select&gt;</span>

	<span style=color:#f92672>&lt;resultMap</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#34;CLasses&#34;</span> <span style=color:#a6e22e>id=</span><span style=color:#e6db74>&#34;ClassesResultMap2&#34;</span><span style=color:#f92672>&gt;</span>
	    <span style=color:#f92672>&lt;id</span> <span style=color:#a6e22e>column=</span><span style=color:#e6db74>&#34;c_id&#34;</span> <span style=color:#a6e22e>property=</span><span style=color:#e6db74>&#34;id&#34;</span><span style=color:#f92672>/&gt;</span>
	    <span style=color:#f92672>&lt;result</span> <span style=color:#a6e22e>column=</span><span style=color:#e6db74>&#34;c_name&#34;</span> <span style=color:#a6e22e>property=</span><span style=color:#e6db74>&#34;name&#34;</span><span style=color:#f92672>/&gt;</span>
	    <span style=color:#f92672>&lt;association</span> <span style=color:#a6e22e>property=</span><span style=color:#e6db74>&#34;teacher&#34;</span> <span style=color:#a6e22e>javaType=</span><span style=color:#e6db74>&#34;Teacher&#34;</span> <span style=color:#a6e22e>column=</span><span style=color:#e6db74>&#34;teacher_id&#34;</span> <span style=color:#a6e22e>select=</span><span style=color:#e6db74>&#34;getTeacher&#34;</span><span style=color:#f92672>&gt;</span><span style=color:#f92672>&lt;/association&gt;</span>
	<span style=color:#f92672>&lt;/resultMap&gt;</span>

	<span style=color:#f92672>&lt;select</span> <span style=color:#a6e22e>id=</span><span style=color:#e6db74>&#34;getTeacher&#34;</span> <span style=color:#a6e22e>parameterType=</span><span style=color:#e6db74>&#34;int&#34;</span> <span style=color:#a6e22e>resultType=</span><span style=color:#e6db74>&#34;Teacher&#34;</span><span style=color:#f92672>&gt;</span>
	    select t_id id, t_name name from teacher where t_id=#{id}
	<span style=color:#f92672>&lt;/select&gt;</span>
</code></pre></div><p>方式二：嵌套结果：使用嵌套结果映射来处理重复的联合结果的子集</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml>	 <span style=color:#f92672>&lt;select</span> <span style=color:#a6e22e>id=</span><span style=color:#e6db74>&#34;getClasses2&#34;</span> <span style=color:#a6e22e>parameterType=</span><span style=color:#e6db74>&#34;int&#34;</span> <span style=color:#a6e22e>resultMap=</span><span style=color:#e6db74>&#34;ClassesResultMap&#34;</span><span style=color:#f92672>&gt;</span>
	        select * from class c,teacher t where c.c_id=#{id} and c.teacher_id=t.t_id; 
	<span style=color:#f92672>&lt;/select&gt;</span>

	<span style=color:#f92672>&lt;resultMap</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#34;Classes&#34;</span> <span style=color:#a6e22e>id=</span><span style=color:#e6db74>&#34;ClassesResultMap&#34;</span><span style=color:#f92672>&gt;</span>
	    <span style=color:#f92672>&lt;id</span> <span style=color:#a6e22e>column=</span><span style=color:#e6db74>&#34;c_id&#34;</span> <span style=color:#a6e22e>property=</span><span style=color:#e6db74>&#34;id&#34;</span><span style=color:#f92672>/&gt;</span>
	    <span style=color:#f92672>&lt;result</span> <span style=color:#a6e22e>column=</span><span style=color:#e6db74>&#34;c_name&#34;</span> <span style=color:#a6e22e>property=</span><span style=color:#e6db74>&#34;name&#34;</span><span style=color:#f92672>/&gt;</span>
	    <span style=color:#f92672>&lt;association</span> <span style=color:#a6e22e>column=</span><span style=color:#e6db74>&#34;teacher_id&#34;</span> <span style=color:#a6e22e>property=</span><span style=color:#e6db74>&#34;teacher&#34;</span> <span style=color:#a6e22e>javaType=</span><span style=color:#e6db74>&#34;Teacher&#34;</span><span style=color:#f92672>&gt;</span>
	        <span style=color:#f92672>&lt;id</span> <span style=color:#a6e22e>column=</span><span style=color:#e6db74>&#34;t_id&#34;</span> <span style=color:#a6e22e>property=</span><span style=color:#e6db74>&#34;id&#34;</span><span style=color:#f92672>/&gt;</span>
	        <span style=color:#f92672>&lt;result</span> <span style=color:#a6e22e>column=</span><span style=color:#e6db74>&#34;t_name&#34;</span> <span style=color:#a6e22e>property=</span><span style=color:#e6db74>&#34;name&#34;</span><span style=color:#f92672>/&gt;</span>
	    <span style=color:#f92672>&lt;/association&gt;</span>
	<span style=color:#f92672>&lt;/resultMap&gt;</span>
</code></pre></div><p>d. 测试：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>	<span style=color:#a6e22e>@Test</span>
	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testQueryOO</span><span style=color:#f92672>(</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
	    SqlSession session <span style=color:#f92672>=</span> factory<span style=color:#f92672>.</span><span style=color:#a6e22e>openSession</span><span style=color:#f92672>(</span><span style=color:#f92672>)</span><span style=color:#f92672>;</span>
	    Classes c <span style=color:#f92672>=</span> sqlSession<span style=color:#f92672>.</span><span style=color:#a6e22e>selectOne</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;com.test.CTMapper.getClasses&#34;</span><span style=color:#f92672>,</span> 1<span style=color:#f92672>)</span><span style=color:#f92672>;</span>
	    System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span>c<span style=color:#f92672>)</span><span style=color:#f92672>;</span>
	<span style=color:#f92672>}</span>

	<span style=color:#a6e22e>@Test</span>
	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testQueryOO2</span><span style=color:#f92672>(</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
	    SqlSession session <span style=color:#f92672>=</span> factory<span style=color:#f92672>.</span><span style=color:#a6e22e>openSession</span><span style=color:#f92672>(</span><span style=color:#f92672>)</span><span style=color:#f92672>;</span>
	    Classes c <span style=color:#f92672>=</span> sqlSession<span style=color:#f92672>.</span><span style=color:#a6e22e>selectOne</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;com.test.CTMapper.getClasses2&#34;</span><span style=color:#f92672>,</span> 1<span style=color:#f92672>)</span><span style=color:#f92672>;</span>
	    System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span>c<span style=color:#f92672>)</span><span style=color:#f92672>;</span>
	<span style=color:#f92672>}</span>
</code></pre></div><p>** 一对多 **</p><ol><li>创建表：</li></ol><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL>	<span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> student(
		s_id INT <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span> AUTO_INCREMENT, 
		s_name VARCHAR(<span style=color:#ae81ff>20</span>), 
		class_id INT
	);

	<span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> student(s_name, class_id) <span style=color:#66d9ef>VALUES</span>(<span style=color:#e6db74>&#39;</span><span style=color:#e6db74>xs_B</span><span style=color:#e6db74>&#39;</span>, <span style=color:#ae81ff>1</span>);
	<span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> student(s_name, class_id) <span style=color:#66d9ef>VALUES</span>(<span style=color:#e6db74>&#39;</span><span style=color:#e6db74>xs_D</span><span style=color:#e6db74>&#39;</span>, <span style=color:#ae81ff>1</span>);
	<span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> student(s_name, class_id) <span style=color:#66d9ef>VALUES</span>(<span style=color:#e6db74>&#39;</span><span style=color:#e6db74>xs_E</span><span style=color:#e6db74>&#39;</span>, <span style=color:#ae81ff>1</span>);
	<span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> student(s_name, class_id) <span style=color:#66d9ef>VALUES</span>(<span style=color:#e6db74>&#39;</span><span style=color:#e6db74>xs_A</span><span style=color:#e6db74>&#39;</span>, <span style=color:#ae81ff>2</span>);
	<span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> student(s_name, class_id) <span style=color:#66d9ef>VALUES</span>(<span style=color:#e6db74>&#39;</span><span style=color:#e6db74>xs_H</span><span style=color:#e6db74>&#39;</span>, <span style=color:#ae81ff>2</span>);
	<span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> student(s_name, class_id) <span style=color:#66d9ef>VALUES</span>(<span style=color:#e6db74>&#39;</span><span style=color:#e6db74>xs_J</span><span style=color:#e6db74>&#39;</span>, <span style=color:#ae81ff>2</span>);
</code></pre></div><ol start=2><li>定义实体类：</li></ol><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Student</span> <span style=color:#f92672>{</span>
	    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> id<span style=color:#f92672>;</span>
	    <span style=color:#66d9ef>private</span> String name<span style=color:#f92672>;</span>
	<span style=color:#f92672>}</span>

	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Classes</span> <span style=color:#f92672>{</span>
	    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> id<span style=color:#f92672>;</span>
	    <span style=color:#66d9ef>private</span> String name<span style=color:#f92672>;</span>
	    <span style=color:#66d9ef>private</span> Teacher teacher<span style=color:#f92672>;</span>
	    <span style=color:#66d9ef>private</span> List<span style=color:#f92672>&lt;</span>Student<span style=color:#f92672>&gt;</span> students<span style=color:#f92672>;</span>
	<span style=color:#f92672>}</span>
</code></pre></div><ol start=3><li>定义sql映射文件ClassMapper.xml：(根据classId查询对应的班级信息,包括学生)</li></ol><p>集合的嵌套结果：使用嵌套结果映射来处理重复的联合结果的子集</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml>	 <span style=color:#f92672>&lt;select</span> <span style=color:#a6e22e>id=</span><span style=color:#e6db74>&#34;getClasses3&#34;</span> <span style=color:#a6e22e>parameterType=</span><span style=color:#e6db74>&#34;int&#34;</span> <span style=color:#a6e22e>resultMap=</span><span style=color:#e6db74>&#34;ClassesResultMap3&#34;</span><span style=color:#f92672>&gt;</span>
	        select * from class c,teacher t, student s where c.c_id=#{id} and c.teacher_id=t.t_id and s.class_id=c.c_id 
	<span style=color:#f92672>&lt;/select&gt;</span>

	<span style=color:#f92672>&lt;resultMap</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#34;Classes&#34;</span> <span style=color:#a6e22e>id=</span><span style=color:#e6db74>&#34;ClassesResultMap3&#34;</span><span style=color:#f92672>&gt;</span>
	    <span style=color:#f92672>&lt;id</span> <span style=color:#a6e22e>column=</span><span style=color:#e6db74>&#34;c_id&#34;</span> <span style=color:#a6e22e>property=</span><span style=color:#e6db74>&#34;id&#34;</span><span style=color:#f92672>/&gt;</span>
	    <span style=color:#f92672>&lt;result</span> <span style=color:#a6e22e>column=</span><span style=color:#e6db74>&#34;c_name&#34;</span> <span style=color:#a6e22e>property=</span><span style=color:#e6db74>&#34;name&#34;</span><span style=color:#f92672>/&gt;</span>
	    <span style=color:#f92672>&lt;association</span> <span style=color:#a6e22e>column=</span><span style=color:#e6db74>&#34;teacher_id&#34;</span> <span style=color:#a6e22e>property=</span><span style=color:#e6db74>&#34;teacher&#34;</span> <span style=color:#a6e22e>javaType=</span><span style=color:#e6db74>&#34;Teacher&#34;</span><span style=color:#f92672>&gt;</span>
	        <span style=color:#f92672>&lt;id</span> <span style=color:#a6e22e>column=</span><span style=color:#e6db74>&#34;t_id&#34;</span> <span style=color:#a6e22e>property=</span><span style=color:#e6db74>&#34;id&#34;</span><span style=color:#f92672>/&gt;</span>
	        <span style=color:#f92672>&lt;result</span> <span style=color:#a6e22e>column=</span><span style=color:#e6db74>&#34;t_name&#34;</span> <span style=color:#a6e22e>property=</span><span style=color:#e6db74>&#34;name&#34;</span><span style=color:#f92672>/&gt;</span>
	    <span style=color:#f92672>&lt;/association&gt;</span>
	    <span style=color:#f92672>&lt;collection</span> <span style=color:#a6e22e>property=</span><span style=color:#e6db74>&#34;students&#34;</span> <span style=color:#a6e22e>ofType=</span><span style=color:#e6db74>&#34;Student&#34;</span> <span style=color:#a6e22e>javaType=</span><span style=color:#e6db74>&#34;ArrayList&#34;</span><span style=color:#f92672>&gt;</span>
	        <span style=color:#f92672>&lt;id</span> <span style=color:#a6e22e>property=</span><span style=color:#e6db74>&#34;id&#34;</span> <span style=color:#a6e22e>column=</span><span style=color:#e6db74>&#34;s_id&#34;</span> <span style=color:#f92672>/&gt;</span>
	        <span style=color:#f92672>&lt;result</span> <span style=color:#a6e22e>property=</span><span style=color:#e6db74>&#34;name&#34;</span> <span style=color:#a6e22e>column=</span><span style=color:#e6db74>&#34;s_name&#34;</span><span style=color:#f92672>/&gt;</span>
	    <span style=color:#f92672>&lt;/collection&gt;</span>
	<span style=color:#f92672>&lt;/resultMap&gt;</span>
</code></pre></div><p>集合的嵌套查询方式, 通过执行另外一个SQL映射语句来返回预期的复杂类型</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml>	<span style=color:#f92672>&lt;select</span> <span style=color:#a6e22e>id=</span><span style=color:#e6db74>&#34;getClasses4&#34;</span> <span style=color:#a6e22e>parameterType=</span><span style=color:#e6db74>&#34;int&#34;</span> <span style=color:#a6e22e>resultMap=</span><span style=color:#e6db74>&#34;ClassesResultMap4&#34;</span><span style=color:#f92672>&gt;</span>
	        select * from class c where c.c_id=#{id}
	<span style=color:#f92672>&lt;/select&gt;</span>
	<span style=color:#f92672>&lt;resultMap</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#34;CLasses&#34;</span> <span style=color:#a6e22e>id=</span><span style=color:#e6db74>&#34;ClassesResultMap4&#34;</span><span style=color:#f92672>&gt;</span>
	    <span style=color:#f92672>&lt;id</span> <span style=color:#a6e22e>column=</span><span style=color:#e6db74>&#34;c_id&#34;</span> <span style=color:#a6e22e>property=</span><span style=color:#e6db74>&#34;id&#34;</span><span style=color:#f92672>/&gt;</span>
	    <span style=color:#f92672>&lt;result</span> <span style=color:#a6e22e>column=</span><span style=color:#e6db74>&#34;c_name&#34;</span> <span style=color:#a6e22e>property=</span><span style=color:#e6db74>&#34;name&#34;</span><span style=color:#f92672>/&gt;</span>
	    <span style=color:#f92672>&lt;association</span> <span style=color:#a6e22e>property=</span><span style=color:#e6db74>&#34;teacher&#34;</span> <span style=color:#a6e22e>javaType=</span><span style=color:#e6db74>&#34;Teacher&#34;</span> <span style=color:#a6e22e>column=</span><span style=color:#e6db74>&#34;teacher_id&#34;</span> <span style=color:#a6e22e>select=</span><span style=color:#e6db74>&#34;getTeacher&#34;</span><span style=color:#f92672>&gt;</span><span style=color:#f92672>&lt;/association&gt;</span>
	    <span style=color:#f92672>&lt;collection</span> <span style=color:#a6e22e>property=</span><span style=color:#e6db74>&#34;students&#34;</span> <span style=color:#a6e22e>ofType=</span><span style=color:#e6db74>&#34;Teacher&#34;</span> <span style=color:#a6e22e>column=</span><span style=color:#e6db74>&#34;c_id&#34;</span> <span style=color:#a6e22e>select=</span><span style=color:#e6db74>&#34;getStudentsSelect&#34;</span> <span style=color:#f92672>&gt;</span><span style=color:#f92672>&lt;/collection&gt;</span>
	<span style=color:#f92672>&lt;/resultMap&gt;</span>

	<span style=color:#f92672>&lt;select</span> <span style=color:#a6e22e>id=</span><span style=color:#e6db74>&#34;getTeacher&#34;</span> <span style=color:#a6e22e>parameterType=</span><span style=color:#e6db74>&#34;int&#34;</span> <span style=color:#a6e22e>resultType=</span><span style=color:#e6db74>&#34;Teacher&#34;</span><span style=color:#f92672>&gt;</span>
	    select t_id id, t_name name from teacher where t_id=#{id}
	<span style=color:#f92672>&lt;/select&gt;</span>
	<span style=color:#f92672>&lt;select</span> <span style=color:#a6e22e>id=</span><span style=color:#e6db74>&#34;getStudentsSelect&#34;</span> <span style=color:#a6e22e>parameterType=</span><span style=color:#e6db74>&#34;int&#34;</span> <span style=color:#a6e22e>resultType=</span><span style=color:#e6db74>&#34;Student&#34;</span> <span style=color:#f92672>&gt;</span>
	    select s_id id, s_name name from student where class_id=#{id}
	<span style=color:#f92672>&lt;/select&gt;</span>
</code></pre></div><ol start=4><li>测试：</li></ol><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>	<span style=color:#a6e22e>@Test</span>
	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testQueryOT</span><span style=color:#f92672>(</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
	    SqlSession session <span style=color:#f92672>=</span> factory<span style=color:#f92672>.</span><span style=color:#a6e22e>openSession</span><span style=color:#f92672>(</span><span style=color:#f92672>)</span><span style=color:#f92672>;</span>
	    Classes classes <span style=color:#f92672>=</span> openSession<span style=color:#f92672>.</span><span style=color:#a6e22e>selectOne</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;com.test.OMMapper.getClasses3&#34;</span><span style=color:#f92672>,</span> 1<span style=color:#f92672>)</span><span style=color:#f92672>;</span>
	    System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span>c<span style=color:#f92672>)</span><span style=color:#f92672>;</span>
	<span style=color:#f92672>}</span>

	<span style=color:#a6e22e>@Test</span>
	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testQueryOT2</span><span style=color:#f92672>(</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
	    SqlSession session <span style=color:#f92672>=</span> factory<span style=color:#f92672>.</span><span style=color:#a6e22e>openSession</span><span style=color:#f92672>(</span><span style=color:#f92672>)</span><span style=color:#f92672>;</span>
	    Classes classes <span style=color:#f92672>=</span> openSession<span style=color:#f92672>.</span><span style=color:#a6e22e>selectOne</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;com.test.OMMapper.getClasses4&#34;</span><span style=color:#f92672>,</span> 1<span style=color:#f92672>)</span><span style=color:#f92672>;</span>
	    System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span>c<span style=color:#f92672>)</span><span style=color:#f92672>;</span>
	<span style=color:#f92672>}</span>
</code></pre></div></div><div class=post-copyright><p class=copyright-item><span>Author:</span>
<span>nosky</span></p><p class=copyright-item><span>Link:</span>
<a href=https://no-sky.github.io/2018/mybatis%E4%B9%8B%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2/>https://no-sky.github.io/2018/mybatis%E4%B9%8B%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2/</span></p><p class="copyright-item lincese">本文采用<a rel=license href=http://creativecommons.org/licenses/by-nc/4.0/ target=_blank>知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可</p></div><div class=post-tags><section><i class="iconfont icon-tag"></i>Tag(s):
<span class=tag><a href=https://no-sky.github.io/tags/mybatis/>#mybatis</a></span></section><section><a href=javascript:window.history.back();>back</a></span> ·
<span><a href=https://no-sky.github.io>home</a></span></section></div><div class=post-nav><a href=https://no-sky.github.io/2018/mybatis%E4%B9%8B%E4%BC%98%E5%8C%96xml%E9%85%8D%E7%BD%AE/ class=prev rel=prev title=Mybatis之优化XML配置><i class="iconfont icon-left"></i>&nbsp;Mybatis之优化XML配置</a>
<a href=https://no-sky.github.io/2018/mybatis-generator%E4%B9%8Bmybatis%E7%9A%84%E5%BF%AB%E9%80%9F%E4%BD%BF%E7%94%A8/ class=next rel=next title=Mybatis-generator之mybatis的快速使用>Mybatis-generator之mybatis的快速使用&nbsp;<i class="iconfont icon-right"></i></a></div><div class=post-comment></div></article></div></main><footer class=footer><div class=copyright>&copy;
<span itemprop=copyrightYear>2016 - 2019</span>
<span class=with-love><i class="iconfont icon-love"></i></span><span class=author itemprop=copyrightHolder><a href=https://no-sky.github.io>nosky</a> |</span>
<a href=http://www.miibeian.gov.cn/ target=_blank rel="external nofollow">湘ICP备19027112号</a> |
<span>Powered by <a href=https://gohugo.io/ target=_blank rel="external nofollow">Hugo</a> & <a href=https://github.com/liuzc/leaveit target=_blank rel="external nofollow">LeaveIt</a></span></br><span><a href=https://www.upyun.com/><img style=width:80px;height:30px;background-color:#70847d src=/images/upyun.png alt></a></span></div></footer><script src=/js/vendor_no_gallery.min.js async></script></div></body></html>